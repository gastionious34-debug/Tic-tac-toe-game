<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</title>

<style>
/* ===== –¢–ï–ú–´ ===== */
body.dark{
    background:#1e1e2f;
    color:#ffffff;
}
body.light{
    background:#f2f2f2;
    color:#000000;
}

/* ===== –û–°–ù–û–í–ê ===== */
body{
    margin:0;
    font-family:Arial, sans-serif;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}

.app{
    background:inherit;
    border:2px solid currentColor;
    padding:16px;
    border-radius:12px;
    width:340px;
}

/* ===== –ö–ù–û–ü–ö–ò ===== */
button, select{
    width:100%;
    padding:8px;
    margin:6px 0;
    font-size:14px;
    cursor:pointer;
}

button{
    background:#6c7cff;
    color:white;
    border:none;
}

/* ===== –°–ß–Å–¢ ===== */
.score{
    display:flex;
    justify-content:space-between;
    font-size:14px;
    margin:6px 0;
}

/* ===== –ü–û–õ–ï ===== */
.board{
    display:grid;
    grid-template-columns:repeat(3,100px);
    gap:8px;
    justify-content:center;
    margin:12px 0;
    cursor:pointer; /* üîë */
}

.cell{
    width:100px;
    height:100px;
    background:#ffffff;
    color:#000000;
    font-size:48px;
    display:flex;
    align-items:center;
    justify-content:center;
    user-select:none;
    cursor:pointer !important; /* üîë */
    border:2px solid #000;
}

body.dark .cell{
    background:#ffffff;
    color:#000000;
}

.cell:hover{
    background:#ddd;
}

.cell.win{
    background:#8bff9a;
    animation:pulse .5s infinite alternate;
}

@keyframes pulse{
    from{transform:scale(1)}
    to{transform:scale(1.08)}
}

#status{
    text-align:center;
    margin:6px 0;
}
</style>
</head>
<body class="dark">

<div class="app">

<h2 style="text-align:center">–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</h2>

<select id="mode">
    <option value="bot">–ò–≥—Ä–æ–∫ vs –ö–æ–º–ø—å—é—Ç–µ—Ä</option>
    <option value="pvp">–ò–≥—Ä–æ–∫ vs –ò–≥—Ä–æ–∫</option>
</select>

<select id="difficulty">
    <option value="easy">–õ—ë–≥–∫–∏–π</option>
    <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
    <option value="hard" selected>–°–ª–æ–∂–Ω—ã–π</option>
</select>

<button onclick="toggleTheme()">üåô / ‚òÄÔ∏è –¢–µ–º–∞</button>

<div class="score">
    <div>X: <span id="sx">0</span></div>
    <div>O: <span id="so">0</span></div>
    <div>–ù–∏—á—å–∏: <span id="sd">0</span></div>
</div>

<div id="status">–•–æ–¥: X</div>

<div class="board">
    <div class="cell" data-i="0"></div>
    <div class="cell" data-i="1"></div>
    <div class="cell" data-i="2"></div>
    <div class="cell" data-i="3"></div>
    <div class="cell" data-i="4"></div>
    <div class="cell" data-i="5"></div>
    <div class="cell" data-i="6"></div>
    <div class="cell" data-i="7"></div>
    <div class="cell" data-i="8"></div>
</div>

<button onclick="resetGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>

</div>

<audio id="click">
<source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=">
</audio>

<script>
const cells=document.querySelectorAll(".cell");
const status=document.getElementById("status");
const mode=document.getElementById("mode");
const diff=document.getElementById("difficulty");
const click=document.getElementById("click");

let board,turn="X",active=true;
let score={x:0,o:0,d:0};

const wins=[
[0,1,2],[3,4,5],[6,7,8],
[0,3,6],[1,4,7],[2,5,8],
[0,4,8],[2,4,6]
];

cells.forEach(c=>{
    c.addEventListener("click",()=>{
        const i=+c.dataset.i;
        if(!active||board[i]) return;
        play();
        move(i,turn);
        if(end(turn)) return;
        turn=turn==="X"?"O":"X";
        status.textContent="–•–æ–¥: "+turn;
        if(mode.value==="bot" && turn==="O"){
            setTimeout(bot,300);
        }
    });
});

function bot(){
    let i;
    if(diff.value==="easy") i=random();
    else if(diff.value==="medium") i=Math.random()<0.5?random():best();
    else i=Math.random()<0.9?best():random();
    play();
    move(i,"O");
    end("O");
    turn="X";
    status.textContent="–•–æ–¥: X";
}

function move(i,p){
    board[i]=p;
    cells[i].textContent=p;
}

function end(p){
    for(const w of wins){
        if(w.every(i=>board[i]===p)){
            w.forEach(i=>cells[i].classList.add("win"));
            status.textContent="–ü–æ–±–µ–¥–∞: "+p;
            score[p.toLowerCase()]++;
            updateScore();
            active=false;
            return true;
        }
    }
    if(board.every(Boolean)){
        status.textContent="–ù–∏—á—å—è";
        score.d++;
        updateScore();
        active=false;
        return true;
    }
    return false;
}

function random(){
    const e=board.map((v,i)=>v?null:i).filter(v=>v!==null);
    return e[Math.floor(Math.random()*e.length)];
}

function best(){
    let best=-Infinity,move;
    for(let i=0;i<9;i++){
        if(board[i]) continue;
        board[i]="O";
        let s=minimax(false);
        board[i]="";
        if(s>best){best=s;move=i;}
    }
    return move;
}

function minimax(t){
    if(wins.some(w=>w.every(i=>board[i]==="O"))) return 10;
    if(wins.some(w=>w.every(i=>board[i]==="X"))) return -10;
    if(board.every(Boolean)) return 0;
    let best=t?-Infinity:Infinity;
    for(let i=0;i<9;i++){
        if(board[i]) continue;
        board[i]=t?"O":"X";
        let s=minimax(!t);
        board[i]="";
        best=t?Math.max(best,s):Math.min(best,s);
    }
    return best;
}

function resetGame(){
    board=Array(9).fill("");
    active=true;
    turn="X";
    status.textContent="–•–æ–¥: X";
    cells.forEach(c=>{
        c.textContent="";
        c.classList.remove("win");
    });
}

function updateScore(){
    sx.textContent=score.x;
    so.textContent=score.o;
    sd.textContent=score.d;
}

function toggleTheme(){
    document.body.classList.toggle("light");
    document.body.classList.toggle("dark");
}

function play(){
    click.currentTime=0;
    click.play().catch(()=>{});
}

resetGame();
</script>

</body>
</html>
